<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Matcha - Matchs de <%= infos.first_name %></title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <link href="/styles/styles.css" rel="stylesheet" type="text/css">
    </head>
 
    <body>
        <div class="container-fluid">
        	<div id="0">
                <% include partials/nav %>
            </div>
            <button class="btn btn-dark btn-block" data-toggle="collapse" data-target="#match">Mes matchs</button>
            <div id="match" class="collapse">
                <div class="card-deck">
                    <% profiles.forEach(function(item) { 
                      if (like.includes(item.user_ID) && like_me.includes(item.user_ID) && !block_me.includes(item.user_ID) && !block.includes(item.user_ID)) { %>
                    <div class="card carte mx-auto">
                        <div class="card-header">
                            <strong><%= item.first_name %></strong>
                        </div>
                          <div class="popup">
                            <img class="card-img-top carte_image" src="<%= item.profile_picture %>" title="Profile de <%= item.login %>">
                            <!-- Button to Open the Modal -->
                            <div class="carte_button">
                              <button  onclick="myFunction('<%= item.login %>_match', '<%= item.user_ID %>')" type="button" class="btn btn-primary" data-toggle="modal" data-target="#<%= item.login %>_match">
                                Voir plus
                              </button>
                            </div>

                            <!-- The Modal -->
                            <div class="modal fade" id="<%= item.login %>_match">
                              <div class="modal-dialog">
                                <div class="modal-content">

                                  <!-- Modal Header -->
                                  <div class="modal-header mx-auto">
                                    <h4 class="modal-title mx-auto"><%= item.first_name %></h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>

                                  <!-- Modal body -->
                                <div class="modal-body mx-auto">
                                    <span id="<%= item.login %>_match" class="mx-auto">
                                      <p class="mx-auto">Age : <%= item.age %> ans</p>
                                      <p class="mx-auto">Genre : <%= item.gender %></p>
                                      <p class="mx-auto">Intéressé par : <%= item.orientation %></p>
                                      <p class="mx-auto">Bio : <%= item.bio %></p>
                                      <p class="mx-auto">Score de popularité : <% if (item.score == null) { %>Too Fresh<% } else { %><%= item.score %>/100<% } %></p>
                                     
                                    <div id="demo" class="carousel slide mx-auto" data-ride="carousel">
                                      <!-- Indicators -->
                                      <ul class="carousel-indicators">
                                        <% if (item.profile_picture != null) { %>
                                        <li data-target="#demo" data-slide-to="0" class="active"></li>
                                        <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                        <li data-target="#demo" data-slide-to="1"></li>
                                        <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                        <li data-target="#demo" data-slide-to="2"></li>
                                        <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                        <li data-target="#demo" data-slide-to="3"></li>
                                        <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                        <li data-target="#demo" data-slide-to="4"></li>
                                        <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                        <li data-target="#demo" data-slide-to="5"></li>
                                        <% } %>
                                      </ul>

                                      <!-- The slideshow -->
                                      <div class="carousel-inner mx-auto">
                                        <% if (item.profile_picture != null) { %>
                                        <div class="carousel-item active">
                                          <img class="account_image d-block w-100" src="<%= item.profile_picture %>" title="Photo de profile de <%= item.login %>">
                                        </div>
                                        <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                        <div class="carousel-item">
                                          <img class="account_image d-block w-100" src="<%= item.image_1 %>" title="Photo 1 de <%= item.login %>">
                                        </div>
                                        <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                        <div class="carousel-item">
                                          <img class="account_image d-block w-100" src="<%= item.image_2 %>" title="Photo 2 de <%= item.login %>">
                                        </div>
                                        <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                        <div class="carousel-item">
                                          <img class="account_image d-block w-100" src="<%= item.image_3 %>" title="Photo 3 de <%= item.login %>">
                                        </div>
                                        <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                        <div class="carousel-item">
                                          <img class="account_image d-block w-100" src="<%= item.image_4 %>" title="Photo 4 de <%= item.login %>">
                                        </div>
                                        <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                        <div class="carousel-item">
                                          <img class="account_image d-block w-100" src="<%= item.image_5 %>" title="Photo 5 de <%= item.login %>">
                                        </div>
                                        <% } %>
                                      </div>

                                      <!-- Left and right controls -->
                                      <a class="carousel-control-prev btn-block btn-light" role="button" href="#demo" data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                      </a>
                                      <a class="carousel-control-next btn-block btn-light" role="button" href="#demo" data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                      </a>
                                    </div>
                                      <form class="mx-auto" action="unlike_block" method="post">
                                        <input type="hidden" name="liked_ID" value="<%= item.user_ID %>">
                                        <input class="mx-auto bg-danger" type="submit" name="submit" value="Unlike">
                                        <input class="mx-auto bg-danger" type="submit" name="submit" value="Block">
                                      </form>
                                  </div>

                                  <!-- Modal footer -->
                                  <div class="modal-footer mx-auto">
                                    <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                  <%      }
                  }) %>
                </div>
            </div>
            <button class="btn btn-dark btn-block" data-toggle="collapse" data-target="#liker">Profils que j'ai likés</button>
            <div id="liker" class="collapse">
                <div class="card-deck">
                  <% profiles.forEach(function(item) { 
                      if (like.includes(item.user_ID) && !block_me.includes(item.user_ID)) { %>
                    <div class="card carte mx-auto">
                    <div class="card-header">
                        <strong><%= item.first_name %></strong>
                    </div>
                      <div class="popup">
                        <img class="card-img-top carte_image" src="<%= item.profile_picture %>" title="Profile de <%= item.login %>">
                        <!-- Button to Open the Modal -->
                        <div class="carte_button">
                          <button  onclick="myFunction('<%= item.login %>_like', '<%= item.user_ID %>')" type="button" class="btn btn-primary" data-toggle="modal" data-target="#<%= item.login %>_like">
                            Voir plus
                          </button>
                        </div>

                        <!-- The Modal -->
                        <div class="modal fade" id="<%= item.login %>_like">
                          <div class="modal-dialog">
                            <div class="modal-content">

                              <!-- Modal Header -->
                              <div class="modal-header mx-auto">
                                <h4 class="modal-title mx-auto"><%= item.first_name %></h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                              </div>

                              <!-- Modal body -->
                              <div class="modal-body mx-auto">
                                <span id="<%= item.login %>_like" class="mx-auto">
                                  <p class="mx-auto">Age : <%= item.age %> ans</p>
                                  <p class="mx-auto">Genre : <%= item.gender %></p>
                                  <p class="mx-auto">Intéressé par : <%= item.orientation %></p>
                                  <p class="mx-auto">Bio : <%= item.bio %></p>
                                  <p class="mx-auto">Score de popularité : <% if (item.score == null) { %>Too Fresh<% } else { %><%= item.score %>/100<% } %></p>
                                 
                                <div id="demo" class="carousel slide mx-auto" data-ride="carousel">
                                  <!-- Indicators -->
                                  <ul class="carousel-indicators">
                                    <% if (item.profile_picture != null) { %>
                                    <li data-target="#demo" data-slide-to="0" class="active"></li>
                                    <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="1"></li>
                                    <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="2"></li>
                                    <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="3"></li>
                                    <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="4"></li>
                                    <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="5"></li>
                                    <% } %>
                                  </ul>

                                  <!-- The slideshow -->
                                  <div class="carousel-inner mx-auto">
                                    <% if (item.profile_picture != null) { %>
                                    <div class="carousel-item active">
                                      <img class="account_image d-block w-100" src="<%= item.profile_picture %>" title="Photo de profile de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_1 %>" title="Photo 1 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_2 %>" title="Photo 2 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_3 %>" title="Photo 3 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_4 %>" title="Photo 4 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_5 %>" title="Photo 5 de <%= item.login %>">
                                    </div>
                                    <% } %>
                                  </div>

                                  <!-- Left and right controls -->
                                  <a class="carousel-control-prev btn-block btn-light" role="button" href="#demo" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                  </a>
                                  <a class="carousel-control-next btn-block btn-light" role="button" href="#demo" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                  </a>
                                </div>
                                  <form class="mx-auto" action="unlike_block" method="post">
                                      <input type="hidden" name="liked_ID" value="<%= item.user_ID %>">
                                      <input class="mx-auto bg-danger" type="submit" name="submit" value="Unlike">
                                      <input class="mx-auto bg-danger" type="submit" name="submit" value="Block">
                                  </form>
                              </div>

                              <!-- Modal footer -->
                              <div class="modal-footer mx-auto">
                                <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  <%      }
                  }) %>
                </div>
            </div>
            <button class="btn btn-dark btn-block" data-toggle="collapse" data-target="#liked">Profils qui m'ont liké</button>
            <div id="liked" class="collapse">
                <div class="card-deck">
                  <% profiles.forEach(function(item) { 
                      if (like_me.includes(item.user_ID) && !block_me.includes(item.user_ID)) { %>
                    <div class="card carte mx-auto">
                        <div class="card-header">
                            <strong><%= item.first_name %></strong>
                        </div>
                      <div class="popup">
                        <img class="card-img-top carte_image" src="<%= item.profile_picture %>" title="Profile de <%= item.login %>">
                        <!-- Button to Open the Modal -->
                        <div class="carte_button">
                          <button  onclick="myFunction('<%= item.login %>_like_me', '<%= item.user_ID %>')" type="button" class="btn btn-primary" data-toggle="modal" data-target="#<%= item.login %>_like_me">
                            Voir plus
                          </button>
                        </div>

                        <!-- The Modal -->
                        <div class="modal fade" id="<%= item.login %>_like_me">
                          <div class="modal-dialog">
                            <div class="modal-content">

                              <!-- Modal Header -->
                              <div class="modal-header mx-auto">
                                <h4 class="modal-title mx-auto"><%= item.first_name %></h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                              </div>

                              <!-- Modal body -->
                              <div class="modal-body mx-auto">
                                <span id="<%= item.login %>_like_me" class="mx-auto">
                                  <p class="mx-auto">Age : <%= item.age %> ans</p>
                                  <p class="mx-auto">Genre : <%= item.gender %></p>
                                  <p class="mx-auto">Intéressé par : <%= item.orientation %></p>
                                  <p class="mx-auto">Bio : <%= item.bio %></p>
                                  <p class="mx-auto">Score de popularité : <% if (item.score == null) { %>Too Fresh<% } else { %><%= item.score %>/100<% } %></p>
                                 
                                <div id="demo" class="carousel slide mx-auto" data-ride="carousel">
                                  <!-- Indicators -->
                                  <ul class="carousel-indicators">
                                    <% if (item.profile_picture != null) { %>
                                    <li data-target="#demo" data-slide-to="0" class="active"></li>
                                    <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="1"></li>
                                    <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="2"></li>
                                    <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="3"></li>
                                    <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="4"></li>
                                    <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="5"></li>
                                    <% } %>
                                  </ul>

                                  <!-- The slideshow -->
                                  <div class="carousel-inner mx-auto">
                                    <% if (item.profile_picture != null) { %>
                                    <div class="carousel-item active">
                                      <img class="account_image d-block w-100" src="<%= item.profile_picture %>" title="Photo de profile de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_1 %>" title="Photo 1 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_2 %>" title="Photo 2 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_3 %>" title="Photo 3 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_4 %>" title="Photo 4 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_5 %>" title="Photo 5 de <%= item.login %>">
                                    </div>
                                    <% } %>
                                  </div>

                                  <!-- Left and right controls -->
                                  <a class="carousel-control-prev btn-block btn-light" role="button" href="#demo" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                  </a>
                                  <a class="carousel-control-next btn-block btn-light" role="button" href="#demo" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                  </a>
                                </div>
                                  <form class="mx-auto" action="unlike_block" method="post">
                                    <input type="hidden" name="liked_ID" value="<%= item.user_ID %>">
                                    <input class="mx-auto bg-danger" type="submit" name="submit" value="Block">
                                  </form>
                              </div>

                              <!-- Modal footer -->
                              <div class="modal-footer mx-auto">
                                <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  <%      }
                  }) %>
                </div>
            </div>
            <button class="btn btn-dark btn-block" data-toggle="collapse" data-target="#blocked">Profils que j'ai bloqués</button>
            <div id="blocked" class="collapse">
                <div class="card-deck">
                  <% profiles.forEach(function(item) { 
                      if (block.includes(item.user_ID) && !block_me.includes(item.user_ID)) { %>
                    <div class="card carte mx-auto">
                    <div class="card-header">
                        <strong><%= item.first_name %></strong>
                    </div>
                      <div class="popup">
                        <img class="card-img-top carte_image" src="<%= item.profile_picture %>" title="Profile de <%= item.login %>">
                        <!-- Button to Open the Modal -->
                        <div class="carte_button">
                          <button  onclick="myFunction('<%= item.login %>_block', '<%= item.user_ID %>')" type="button" class="btn btn-primary" data-toggle="modal" data-target="#<%= item.login %>_block">
                            Voir plus
                          </button>
                        </div>

                        <!-- The Modal -->
                        <div class="modal fade" id="<%= item.login %>_block">
                          <div class="modal-dialog">
                            <div class="modal-content">

                              <!-- Modal Header -->
                              <div class="modal-header mx-auto">
                                <h4 class="modal-title mx-auto"><%= item.first_name %></h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                              </div>

                              <!-- Modal body -->
                              <div class="modal-body mx-auto">
                                <span id="<%= item.login %>_block" class="mx-auto">
                                  <p class="mx-auto">Age : <%= item.age %> ans</p>
                                  <p class="mx-auto">Genre : <%= item.gender %></p>
                                  <p class="mx-auto">Intéressé par : <%= item.orientation %></p>
                                  <p class="mx-auto">Bio : <%= item.bio %></p>
                                  <p class="mx-auto">Score de popularité : <% if (item.score == null) { %>Too Fresh<% } else { %><%= item.score %>/100<% } %></p>
                                 
                                <div id="demo" class="carousel slide mx-auto" data-ride="carousel">
                                  <!-- Indicators -->
                                  <ul class="carousel-indicators">
                                    <% if (item.profile_picture != null) { %>
                                    <li data-target="#demo" data-slide-to="0" class="active"></li>
                                    <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="1"></li>
                                    <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="2"></li>
                                    <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="3"></li>
                                    <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="4"></li>
                                    <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                    <li data-target="#demo" data-slide-to="5"></li>
                                    <% } %>
                                  </ul>

                                  <!-- The slideshow -->
                                  <div class="carousel-inner mx-auto">
                                    <% if (item.profile_picture != null) { %>
                                    <div class="carousel-item active">
                                      <img class="account_image d-block w-100" src="<%= item.profile_picture %>" title="Photo de profile de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_1 != null && item.image_1 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_1 %>" title="Photo 1 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_2 != null && item.image_2 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_2 %>" title="Photo 2 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_3 != null && item.image_3 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_3 %>" title="Photo 3 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_4 != null && item.image_4 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_4 %>" title="Photo 4 de <%= item.login %>">
                                    </div>
                                    <% } if (item.image_5 != null && item.image_5 != item.profile_picture) { %>
                                    <div class="carousel-item">
                                      <img class="account_image d-block w-100" src="<%= item.image_5 %>" title="Photo 5 de <%= item.login %>">
                                    </div>
                                    <% } %>
                                  </div>

                                  <!-- Left and right controls -->
                                  <a class="carousel-control-prev btn-block btn-light" role="button" href="#demo" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                  </a>
                                  <a class="carousel-control-next btn-block btn-light" role="button" href="#demo" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                  </a>
                                </div>
                                  <form class="mx-auto" action="unlike_block" method="post">
                                    <input type="hidden" name="liked_ID" value="<%= item.user_ID %>">
                                    <input class="mx-auto bg-success" type="submit" name="submit" value="Unblock">
                                  </form>
                              </div>

                              <!-- Modal footer -->
                              <div class="modal-footer mx-auto">
                                <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  <%      }
                  }) %>
                </div>
            </div>
        </div>
    </body>
    <script type="text/javascript">
        setInterval('updateDiv()', 3000);
        function updateDiv() { 
            $( "#0" ).load(window.location.href + " #0" );
        }
        // Ajoute une notification lors des visites de profiles
      function myFunction(login, visited_ID) {
        $.post('visit', {visited_ID: visited_ID});
      }
    </script>
</html>