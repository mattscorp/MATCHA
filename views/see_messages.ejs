<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Matcha - Conversations de <%= messaging_first_name %></title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <link href="/styles/styles.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div class="container-fluid">
        	<div id="0">
                <% include partials/nav %>
            </div>
            <h1>Messages de <%= infos_messaged.first_name %></h1>
            <img class="account_image" src="<%= infos_messaged.profile_picture %>" title="Profile de <%= infos_messaged.login %>">
            <div class="jumbotron" id="here">
                <% messages.forEach(function(item) { %>
                    <% if (item.sender_ID == messaging_ID) { %>
                        <div class="media bg-primary border p-3">
                            <img src="<%= messaging_profile_picture %>" alt="Photo de <%= messaging_first_name %>" class="mr-3 mt-3 rounded-circle" style="width:60px;">
                            <div class="media-body">
                                <p><%= messaging_first_name %><small><i> le <%= item.date.split('-')[2].split('T')[0]; %>/<%= item.date.split('-')[1]; %>/<%= item.date.split('-')[0]; %> à <%= item.date.split('T')[1].split('.')[0] %></i></small> : <kbd><%= item.message %></kbd></p>
                            </div>
                        </div>
                    <% } else if (item.recipient_ID == messaging_ID) { %>
                        <div class="media bg-info border p-3">
                            <img src="<%= infos_messaged.profile_picture %>" alt="Photo de <%= infos_messaged.first_name %>" class="mr-3 mt-3 rounded-circle" style="width:60px;">
                            <div class="media-body">
                                <p><%= infos_messaged.first_name %><small><i> le <%= item.date.split('-')[2].split('T')[0]; %>/<%= item.date.split('-')[1]; %>/<%= item.date.split('-')[0]; %> à <%= item.date.split('T')[1].split('.')[0] %></i></small> : <kbd><%= item.message %></kbd></p>
                            </div>
                        </div>
                    <% }
                }) %>
            </div>
            <form action="new_message" method="post">
                <input type="hidden" name="sender_ID" value="<%= messaging_ID %>">
                <input type="hidden" name="recipient_ID" value="<%= infos_messaged.user_ID %>">
                <input required type="text" name="message" placeholder="Nouveau message">
                <input class="btn btn-dark" type="submit" name="submit" value="Envoyer">
            </form>
        </div>
    </body>
    <script type="text/javascript">
        setInterval('load_geo()', 3000);
        function load_geo() {
            $.getJSON('http://www.geoplugin.net/json.gp?jsoncallback=?', function(data) {
                $.post('geo', data, function(data) {
                });
            });
        }
        setInterval('updateDiv()', 3000);
        function updateDiv() { 
            $( "#here" ).load(window.location.href + " #here" );
        }
        function updateDiv2() { 
            $( "#0" ).load(window.location.href + " #0" );
        }
    </script>
</html>